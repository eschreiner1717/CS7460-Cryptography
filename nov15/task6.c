#include <stdio.h>
#include <openssl/bn.h>
#include <string.h>

void printBN(char *msg, BIGNUM *a) {
    char *number_str = BN_bn2hex(a);
    printf("%s %s\n", msg, number_str);
    OPENSSL_free(number_str);
}

int main() {
    BN_CTX *ctx = BN_CTX_new();

    BIGNUM *n = BN_new();
    BIGNUM *e = BN_new();
    BIGNUM *S = BN_new();
    BIGNUM *M = BN_new();
    BIGNUM *S_Decrypted = BN_new();

    BN_hex2bn(&n, "CCF710624FA6BB636FED905256C56D277B7A12568AF1F4F9D6E7E18FBD95ABF260411570DB1200FA270AB557385B7DB2519371950E6A41945B351BFA7BFABBC5BE2430FE56EFC4F37D97E314F5144DCBA710F216EAAB22F031221161699026BA78D9971FE37D66AB75449573C8ACFFEF5D0A8A5943E1ACB23A0FF348FCD76B37C163DCDE46D6DB45FE7D23FD90E851071E51A35FED4946547F2C88C5F4139C97153C03E8A139DC690C32C1AF16574C9447427CA2C89C7DE6D44D54AF4299A8C104C2779CD648E4CE11E02A8099F04370CF3F766BD14C49AB245EC20D82FD46A8AB6C93CC6252427592F89AFA5E5EB2B061E51F1FB97F0998E83DFA837F4769A1");
    BN_dec2bn(&e, "65537");
    BN_hex2bn(&S, "018c9577c9b92d6c3d3ce4bfbec1ff27665ed1e029fa43eb1b859735a80eed98535107547afbfd30a199c542c1cb828b2c0d6f48e8b7a6bc116e965efdb1186675ec78f73800b12ad95718454a56011ad01e15303c9e15fb156c860482be60de0533663d1549e3e3e357a8ac654f796b33a8e657eea6bc27a812f6828aede36aa7bfdc7faf0628b7824b301729900361d08a49402d126faf7de45c9f36abb3af92d5e4426c9d589929f538d8d86187bea4c916015068a89c7b162f7b412541cd047d36d220f11c3671063861541b723493512dae885f454f697b607b4b65ff313c743ae1811082c4455f9a365212503458a66539a42cef12d5f7dc791a1a0124");

    BN_mod_exp(S_Decrypted, S, e, n, ctx);

    printBN("Decrypted Signature =", S_Decrypted);

    printf("The original signature hash = b4757ce7679543c2a51ef74d56f7a94025004e9bfa391112818e34440876277a\n");
    //Check if they match
    /*
    if(BN_cmp(M, MOUT) == 0){
	printf("Valid Signature\n");
    } else{
	printf("Invalid Signature\n");
    }
    */


    BN_CTX_free(ctx);
    return 0;
}
